name: Notify Search Engines

on:
  push:
    branches:
      - main
    paths:
      - '_properties/**'
      - '_requests/**'
      - 'sitemap.xml'
      - 'robots.txt'
      - '_config.yml'
      - 'key.txt'                    # أضف هذا
      - 'google*.html'               # أضف هذا لمراقبة ملفات Google التحقق

jobs:
  notify:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout code
        uses: actions/checkout@v3

      - name: Verify Google verification file
        run: |
          echo "Checking Google verification file..."
          if [ -f "google1201055475d84276.html" ]; then
            echo "✅ Google verification file exists"
          else
            echo "⚠️ Google verification file not found"
          fi

      - name: Verify IndexNow key file
        run: |
          echo "Checking IndexNow key file..."
          if [ -f "key.txt" ]; then
            echo "✅ Key.txt exists"
            KEY=$(cat key.txt)
            echo "Key length: ${#KEY} characters"
          else
            echo "❌ Key.txt not found - creating one..."
            echo "48316278893d467499696316278893d4" > key.txt
          fi

      - name: Ping Google about sitemap update
        run: |
          echo "Notifying Google about sitemap update..."
          curl -s "https://www.google.com/ping?sitemap=https://nasr-realestate.github.io/sitemap.xml"
          
      - name: Notify Bing via IndexNow
        run: |
          echo "Notifying Bing via IndexNow..."
          # استخدام المفتاح من key.txt
          KEY=$(cat key.txt)
          curl -s "https://www.bing.com/indexnow?url=https://nasr-realestate.github.io/&key=${KEY}"
