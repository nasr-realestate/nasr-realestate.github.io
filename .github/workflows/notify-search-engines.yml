name: Site Update Notifications

on:
  push:
    branches:
      - main
    paths:
      - '_properties/**'
      - '_requests/**'
      - 'sitemap.xml'
      - 'luxury-gallery.html'
      - 'search-data.json'

jobs:
  notify-search-engines: # ØªÙ… Ø¯Ù…Ø¬ Ø§Ù„Ø®Ø·ÙˆØ§Øª Ù„Ø¶Ù…Ø§Ù† Ø§Ù„ØªØ±ØªÙŠØ¨
    runs-on: ubuntu-latest
    steps:
      - name: Wait for GitHub Pages to deploy
        run: |
          echo "â³ Waiting for 60 seconds to allow GitHub Pages to deploy..."
          sleep 60
          echo "âœ… Deployment wait finished."

      - name: Verify Sitemap and Notify Google
        run: |
          SITEMAP_URL="https://nasr-realestate.github.io/sitemap.xml"
          echo "ğŸ” Checking sitemap at $SITEMAP_URL..."
          
          # Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø£Ù† Ø®Ø±ÙŠØ·Ø© Ø§Ù„Ù…ÙˆÙ‚Ø¹ Ù…ØªØ§Ø­Ø©
          STATUS=$(curl -s -o /dev/null -w "%{http_code}" $SITEMAP_URL)
          
          if [ "$STATUS" -eq 200 ]; then
            echo "âœ… Sitemap is accessible (Status: $STATUS)."
            echo "ğŸ”„ Notifying Google about the update..."
            curl -s "https://www.google.com/ping?sitemap=$SITEMAP_URL"
            echo "âœ… Google has been notified!"
          else
            # ÙÙŠ Ø­Ø§Ù„Ø© ÙØ´Ù„ Ø§Ù„ÙˆØµÙˆÙ„ Ù„Ø®Ø±ÙŠØ·Ø© Ø§Ù„Ù…ÙˆÙ‚Ø¹ØŒ ÙŠØªÙ… Ø¥ÙŠÙ‚Ø§Ù Ø§Ù„Ø¹Ù…Ù„ÙŠØ© Ù…Ø¹ Ø±Ø³Ø§Ù„Ø© Ø®Ø·Ø£
            echo "âŒ ERROR: Sitemap not accessible (Status: $STATUS). Aborting notification."
            exit 1
          fi
          
