---
layout: null
permalink: /measure/
---
<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <title>Ø§Ù„Ù…ØªØ± Ø§Ù„Ø°ÙƒÙŠ | Ø³Ù…Ø³Ø§Ø± Ø·Ù„Ø¨Ùƒ</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;700&display=swap" rel="stylesheet">
    <style>
        body { margin: 0; background-color: #000; color: #fff; font-family: 'Cairo', sans-serif; overflow: hidden; }
        
        #overlay {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            pointer-events: none; display: flex; flex-direction: column; justify-content: space-between; z-index: 10;
        }
        .msg-box {
            background: rgba(0,0,0,0.6); padding: 15px; text-align: center; margin-top: 20px;
        }
        .status { font-size: 1.2rem; font-weight: bold; color: #d4af37; }
        
        #ar-btn {
            position: absolute; bottom: 50px; left: 50%; transform: translateX(-50%);
            background: #d4af37; color: #000; border: 2px solid #fff;
            padding: 15px 40px; font-size: 1.2rem; border-radius: 50px; 
            font-weight: bold; pointer-events: auto; cursor: pointer;
            box-shadow: 0 0 15px #d4af37; display: none;
        }
    </style>
    <!-- Ø§Ø³ØªÙŠØ±Ø§Ø¯ Three.js -->
    <script type="importmap">
        {
            "imports": {
                "three": "https://unpkg.com/three@0.160.0/build/three.module.js"
            }
        }
    </script>
</head>
<body>

    <div id="overlay">
        <div class="msg-box">
            <div id="status-text" class="status">Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„...</div>
        </div>
    </div>

    <button id="ar-btn">ðŸ“· ØªØ´ØºÙŠÙ„ Ø§Ù„ÙƒØ§Ù…ÙŠØ±Ø§</button>

    <script type="module">
        import * as THREE from 'three';

        let camera, scene, renderer;
        let reticle;
        let hitTestSource = null;
        let hitTestSourceRequested = false;
        let points = [];
        let currentLine = null;

        init();

        function init() {
            const container = document.createElement('div');
            document.body.appendChild(container);

            scene = new THREE.Scene();
            camera = new THREE.PerspectiveCamera(70, window.innerWidth / window.innerHeight, 0.01, 20);
            
            const light = new THREE.HemisphereLight(0xffffff, 0xbbbbff, 3);
            light.position.set(0.5, 1, 0.25);
            scene.add(light);

            renderer = new THREE.WebGLRenderer({ antialias: true, alpha: true });
            renderer.setPixelRatio(window.devicePixelRatio);
            renderer.setSize(window.innerWidth, window.innerHeight);
            renderer.xr.enabled = true;
            container.appendChild(renderer.domElement);

            // Ø§Ù„Ù…Ø¤Ø´Ø±
            reticle = new THREE.Mesh(
                new THREE.RingGeometry(0.15, 0.2, 32).rotateX(-Math.PI / 2),
                new THREE.MeshBasicMaterial({ color: 0xffffff })
            );
            reticle.matrixAutoUpdate = false;
            reticle.visible = false;
            scene.add(reticle);

            // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø¯Ø¹Ù…
            if ('xr' in navigator) {
                navigator.xr.isSessionSupported('immersive-ar').then((supported) => {
                    if (supported) {
                        const btn = document.getElementById('ar-btn');
                        btn.style.display = 'block';
                        btn.addEventListener('click', startSession);
                        document.getElementById('status-text').innerText = "Ø§Ø¶ØºØ· Ø§Ù„Ø²Ø± Ø¨Ø§Ù„Ø£Ø³ÙÙ„ ðŸ‘‡";
                    } else {
                        document.getElementById('status-text').innerText = "Ø¬Ù‡Ø§Ø²Ùƒ Ù„Ø§ ÙŠØ¯Ø¹Ù… AR âŒ";
                    }
                });
            }
        }

        async function startSession() {
            // === Ø§Ù„ØªØºÙŠÙŠØ± Ø§Ù„Ø¬Ø°Ø±ÙŠ Ù‡Ù†Ø§ ===
            // Ù†Ø·Ù„Ø¨ 'local' ÙƒØ¥Ø¬Ø¨Ø§Ø±ÙŠØŒ ÙˆÙ†Ø·Ù„Ø¨ 'hit-test' ÙƒØ§Ø®ØªÙŠØ§Ø±ÙŠ
            // Ù‡Ø°Ø§ ÙŠØ¶Ù…Ù† ÙØªØ­ Ø§Ù„ÙƒØ§Ù…ÙŠØ±Ø§ Ø­ØªÙ‰ Ù„Ùˆ Ø§Ù„Ù‚ÙŠØ§Ø³ ÙÙŠÙ‡ Ù…Ø´ÙƒÙ„Ø©
            const sessionInit = { 
                requiredFeatures: ['local'], 
                optionalFeatures: ['hit-test', 'dom-overlay'],
                domOverlay: { root: document.getElementById('overlay') }
            };

            try {
                const session = await navigator.xr.requestSession('immersive-ar', sessionInit);
                renderer.xr.setSession(session);
                
                document.getElementById('ar-btn').style.display = 'none';
                document.getElementById('status-text').innerText = "Ø§Ø¨Ø­Ø« Ø¹Ù† Ø§Ù„Ø£Ø±Ø¶ÙŠØ©...";
                
                session.addEventListener('select', onSelect);
                renderer.setAnimationLoop(render);
            } catch (e) {
                alert("ÙØ´Ù„ Ø§Ù„ØªØ´ØºÙŠÙ„: " + e.message);
            }
        }

        function onSelect() {
            if (reticle.visible) {
                // Ø±Ø³Ù… Ù†Ù‚Ø·Ø©
                const geometry = new THREE.SphereGeometry(0.01, 32, 32);
                const material = new THREE.MeshBasicMaterial({ color: 0xd4af37 });
                const mesh = new THREE.Mesh(geometry, material);
                mesh.position.setFromMatrixPosition(reticle.matrix);
                scene.add(mesh);
                points.push(mesh.position);

                if (points.length === 2) {
                    // Ø­Ø³Ø§Ø¨ Ø§Ù„Ù…Ø³Ø§ÙØ©
                    const dist = points[0].distanceTo(points[1]);
                    document.getElementById('status-text').innerText = `Ø§Ù„Ù…Ø³Ø§ÙØ©: ${dist.toFixed(2)} Ù…ØªØ±`;
                    
                    // Ø±Ø³Ù… Ø§Ù„Ø®Ø·
                    const lineGeo = new THREE.BufferGeometry().setFromPoints(points);
                    const lineMat = new THREE.LineBasicMaterial({ color: 0xffffff, linewidth: 5 });
                    const line = new THREE.Line(lineGeo, lineMat);
                    scene.add(line);
                    
                    points = []; // Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ†
                } else {
                    document.getElementById('status-text').innerText = "Ø­Ø¯Ø¯ Ø§Ù„Ù†Ù‚Ø·Ø© Ø§Ù„Ø«Ø§Ù†ÙŠØ©";
                }
            }
        }

        function render(timestamp, frame) {
            if (frame) {
                const referenceSpace = renderer.xr.getReferenceSpace();
                const session = renderer.xr.getSession();

                if (hitTestSourceRequested === false) {
                    session.requestReferenceSpace('viewer').then((refSpace) => {
                        session.requestHitTestSource({ space: refSpace }).then((source) => {
                            hitTestSource = source;
                        });
                    });
                    hitTestSourceRequested = true;
                }

                if (hitTestSource) {
                    const hitTestResults = frame.getHitTestResults(hitTestSource);
                    if (hitTestResults.length > 0) {
                        const hit = hitTestResults[0];
                        reticle.visible = true;
                        reticle.matrix.fromArray(hit.getPose(referenceSpace).transform.matrix);
                        reticle.material.color.set(0x00ff00); // Ø£Ø®Ø¶Ø±
                    } else {
                        reticle.visible = false;
                    }
                }
            }
            renderer.render(scene, camera);
        }
    </script>
</body>
</html>
